let isJumping=!1;async function initLazyLoader(){const t=document.getElementById("table-of-contents"),e=document.querySelectorAll(".lazy-section");async function s(t){if(t&&"true"!==t.dataset.loaded&&"true"!==t.dataset.loading){t.dataset.loading="true";try{const e=await fetch(t.dataset.src),s=await e.text();t.innerHTML=s,t.dataset.loaded="true",t.style.minHeight="0",t.dispatchEvent(new CustomEvent("sectionLoaded",{detail:{id:t.id}}))}catch(e){console.error(`Failed: ${t.id}`,e)}finally{delete t.dataset.loading}}}const n=new IntersectionObserver(t=>{isJumping||t.forEach(t=>{t.isIntersecting&&(s(t.target),UI.updateProgress(t.target.id))})},{rootMargin:"200px",threshold:0});e.forEach(t=>n.observe(t)),t.addEventListener("click",async t=>{const e=t.target.closest("a");if(!e)return;t.preventDefault();const n=e.getAttribute("href").slice(1),i=document.getElementById(n);if(!i)return;isJumping=!0,document.body.classList.add("is-loading");const a=[s(i)],o=i.previousElementSibling,l=i.nextElementSibling;o?.classList.contains("lazy-section")&&a.push(s(o)),l?.classList.contains("lazy-section")&&a.push(s(l)),await Promise.all(a),i.scrollIntoView({block:"start"}),UI.updateProgress(n),history.pushState&&history.pushState(null,null,`#${n}`),setTimeout(()=>{isJumping=!1,document.body.classList.remove("is-loading")},1e3)})}initLazyLoader();