let tocData=null;const root=document.documentElement;async function init(){try{const e=await fetch("toc.json");if(!e.ok)throw new Error("ToC not found");tocData=await e.json(),populateToC()}catch(e){console.error("Critical Load Error:",e)}}init();const UI={progressRange:90,startOffset:10,updateProgress:e=>{const t=parseInt(e.replace("section-",""));if(isNaN(t)||!tocData)return;const s=UI.startOffset+(t-1)/(tocData.length-1)*UI.progressRange;document.documentElement.style.setProperty("--progress",`${s}%`)}},supportFiles=[{type:"css",dir:"css/",name:"lazy-loading"},{type:"js",dir:"js/",name:"lazy-loading"},{type:"css",dir:"css/",name:"support"},{type:"js",dir:"js/",name:"support"},{type:"js",dir:"js/",name:"panel-donate"},{type:"css",dir:"css/",name:"panel-donate"},{type:"css",dir:"css/",name:"links-container"}];function loadSupportAssets(){if(document.querySelector("[data-support-loaded]"))return;const e=null!==document.querySelector('script[src*=".min.js"]')?".min":"";supportFiles.forEach(t=>{const s="css"===t.type,o=document.createElement(s?"link":"script"),r=`${t.dir}${t.name}${e}.${t.type}`;s?(o.rel="stylesheet",o.href=r):(o.src=r,o.defer=!0),document.head.appendChild(o)});const t=document.createElement("meta");t.setAttribute("data-support-loaded","true"),document.head.appendChild(t),["mousemove","touchstart","scroll","keydown"].forEach(e=>window.removeEventListener(e,loadSupportAssets))}function populateToC(){const e=document.querySelectorAll(".lazy-section"),t=document.getElementById("table-of-contents"),o=document.querySelector("main");e.forEach(e=>{const o=e.dataset.section;if(!o)return;if(!/^section-\d/.test(o))return;e.id||(s,e.id=o);const r=o.replace(/^section-/,""),[n,...a]=r.split("-"),c=a.join(" "),i=c.charAt(0).toUpperCase()+c.slice(1),d=document.createElement("li");d.innerHTML=`<b>${n}.</b> <a href="#${e.id}">${i}</a>`,t.appendChild(d)}),tocData.forEach((e,s)=>{t.insertAdjacentHTML("beforeend",`<li><b>${s+1}.</b> <a href="#${e.id}">${e.title}</a></li>`),document.getElementById(e.id)||o.insertAdjacentHTML("beforeend",`<div class="lazy-section" id="${e.id}" data-src="${e.file}"></div>`)})}["mousemove","touchstart","scroll","keydown"].forEach(e=>window.addEventListener(e,loadSupportAssets,{passive:!0}));const trimTextStream=e=>{e.classList.contains("textstream")&&(e.innerHTML=e.innerHTML.replace(/^\s+|\s+$/g,""))};document.querySelectorAll(".textstream").forEach(trimTextStream);const observer=new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{1===e.nodeType&&(e.classList.contains("textstream")&&trimTextStream(e),e.querySelectorAll(".textstream").forEach(trimTextStream))})})});observer.observe(document.body,{childList:!0,subtree:!0});